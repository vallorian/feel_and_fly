function sprawdzKategorieWagowaWiekowa(){var a=jQuery("#srl-kategoria-wagowa").val(),o=parseInt(jQuery("#srl-rok-urodzenia").val()),r=new Date().getFullYear(),e=jQuery("#srl-waga-ostrzezenie");e.hide();var n=[];o&&r-o<=18&&n.push('<div class="srl-uwaga" style="background:#fff3e0; border:2px solid #ff9800; border-radius:8px; padding:20px; margin-top:10px;"><strong>Lot osoby niepełnoletniej:</strong> Osoby poniżej 18. roku życia mogą wziąć udział w locie tylko za zgodą rodzica lub opiekuna prawnego. Wymagane jest okazanie podpisanej, wydrukowanej zgody w dniu lotu, na miejscu startu. <a href="/zgoda-na-lot-osoba-nieletnia/" target="_blank" style="color:#f57c00; font-weight:bold;">Pobierz zgodę tutaj</a>.</div>'),"91-120kg"===a?n.push('<div class="srl-uwaga" style="background:#fff3e0; border:2px solid #ff9800; border-radius:8px; padding:20px; margin-top:10px;"><strong>Uwaga:</strong> Loty z pasażerami powyżej 90 kg mogą być kr\xf3tsze, brak możliwości wykonania akrobacji. Pilot ma prawo odm\xf3wić wykonania lotu jeśli uzna, że zagraża to bezpieczeństwu.</div>'):"120kg+"===a&&n.push('<div class="srl-uwaga" style="background:#fdeaea; border:2px solid #d63638; border-radius:8px; padding:20px; margin-top:10px; color:#721c24;"><strong>❌ Błąd:</strong> Brak możliwości wykonania lotu z pasażerem powyżej 120 kg.</div>'),n.length>0&&(e.html(n.join("")),e.show())}function sprawdzKompatybilnoscZAkrobacjami(){var a=wybranyLot||window.wybranyLot,o=jQuery("#srl-kategoria-wagowa").val();if(!a||!o)return!0;var r=daneKlienta.dostepne_loty.find(function(o){return o.id==a});return!r||((-1!==r.nazwa_produktu.toLowerCase().indexOf("akrobacj")||"1"==r.ma_akrobacje)&&("91-120kg"===o||"120kg+"===o)?("function"==typeof pokazKomunikat&&pokazKomunikat("Wybrana kategoria wagowa ("+o+") nie jest dostępna dla lot\xf3w z akrobacjami.","error"),!1):"120kg+"!==o||("function"==typeof pokazKomunikat&&pokazKomunikat("Loty nie są możliwe dla pasażer\xf3w powyżej 120 kg.","error"),!1))}jQuery(document).ready(function(a){var o=1,r=1,e=new Date().getMonth()+1,n=new Date().getFullYear(),i=null,t=null,s=null,l=null,d=null;function c(e){if(!(e<1)&&!(e>5)){a(".srl-step").removeClass("srl-step-active srl-step-completed"),a(".srl-progress-bar").removeClass("srl-progress-1 srl-progress-2 srl-progress-3 srl-progress-4 srl-progress-5"),a(".srl-progress-bar").addClass("srl-progress-"+e);for(var n=1;n<=5;n++){var i=a('.srl-step[data-step="'+n+'"]');n<e?i.addClass("srl-step-completed"):n===e&&i.addClass("srl-step-active")}a(".srl-krok").removeClass("srl-krok-active"),a("#srl-krok-"+e).addClass("srl-krok-active"),o=e,r=Math.max(r,e),a("html, body").animate({scrollTop:a("#srl-rezerwacja-container").offset().top-50},300)}}window.wybranyLot=null,window.daneKlienta=null,function o(){console.log("\uD83D\uDD04 [DEBUG] Ładowanie danych klienta..."),g("Ładowanie danych...","info"),a.ajax({url:srlFrontend.ajaxurl,method:"GET",data:{action:"srl_pobierz_dane_klienta",nonce:srlFrontend.nonce},success:function(r){var e,n;m(),r.success?(console.log("✅ [DEBUG] Dane klienta załadowane pomyślnie"),l=r.data,window.daneKlienta=r.data,function o(){var r="Cześć";if(l&&l.dane_osobowe){var e=l.dane_osobowe.imie,n=l.dane_osobowe.nazwisko;e&&n?r="Cześć, "+e+" "+n:e&&(r="Cześć, "+e)}a("#srl-krok-1 h2").text(r+"! \uD83D\uDC4B")}(),e=[],l.rezerwacje&&l.rezerwacje.forEach(function(a){e.push(a)}),l.dostepne_loty&&l.dostepne_loty.forEach(function(a){e.push(a)}),e.sort(function(a,o){return"zarezerwowany"===a.status&&"zarezerwowany"!==o.status?-1:"zarezerwowany"!==a.status&&"zarezerwowany"===o.status?1:0}),function r(e){var n=a("#srl-lista-rezerwacji");if(!e||0===e.length){n.html('<p class="srl-komunikat srl-komunikat-info">Nie masz żadnych lot\xf3w.</p>');return}var i='<table class="srl-tabela-lotow">';i+='<thead><tr><th class="srl-kolumna-nazwa">Nazwa</th><th class="srl-kolumna-status">Status i termin</th><th class="srl-kolumna-opcje">Opcje</th><th class="srl-kolumna-akcje">Akcje</th></tr></thead>',i+="<tbody>",e.forEach(function(a){i+="<tr>",i+='<td class="srl-kolumna-nazwa">',i+='<div class="srl-nazwa-lotu">Lot w tandemie (#'+a.id+")</div>";var o=[];if(a.ma_filmowanie&&"0"!=a.ma_filmowanie?o.push('<span style="color: #46b450;">z filmowaniem</span>'):o.push('<span style="color: #d63638;">bez filmowania</span>'),a.ma_akrobacje&&"0"!=a.ma_akrobacje?o.push('<span style="color: #46b450;">z akrobacjami</span>'):o.push('<span style="color: #d63638;">bez akrobacji</span>'),i+='<div class="srl-opcje-lotu">'+o.join(", ")+"</div>",a.kod_vouchera,a.data_waznosci&&(i+='<div class="srl-data-waznosci">(Ważny do: '+new Date(a.data_waznosci).toLocaleDateString("pl-PL")+")</div>"),i+="</td>",i+='<td class="srl-kolumna-status">',"zarezerwowany"===a.status){if(i+='<div class="srl-status-badge srl-status-zarezerwowany">Zarezerwowany</div>',a.data&&a.godzina_start){var r,e=new Date(a.data),n=["Niedziela","Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota"][e.getDay()],t=e.toLocaleDateString("pl-PL");i+='<div class="srl-termin-info">',i+='<div class="srl-termin-data">'+t+", godz: "+a.godzina_start.substring(0,5)+"</div>",i+='<div class="srl-termin-dzien">'+n+"</div>",i+="</div>"}}else"wolny"===a.status&&(i+='<div class="srl-status-badge srl-status-wolny">Czeka na rezerwację</div>');if(i+="</td>",i+='<td class="srl-kolumna-opcje">',"zarezerwowany"===a.status){var e=new Date(a.data+" "+a.godzina_start),s=e.getTime()-Date.now();if(s>1728e5){var l=[];a.ma_filmowanie&&"0"!=a.ma_filmowanie||l.push({nazwa:"Filmowanie",id:srlFrontend.productIds.filmowanie}),a.ma_akrobacje&&"0"!=a.ma_akrobacje||l.push({nazwa:"Akrobacje",id:srlFrontend.productIds.akrobacje}),l.length>0?l.forEach(function(o,r){i+='<button id="srl-opcja-'+a.id+"-"+o.id+'" class="srl-add-option srl-opcja-btn" data-lot-id="'+a.id+'" data-product-id="'+o.id+'" onclick="srlDodajOpcjeLotu('+a.id+", "+o.id+", '"+o.nazwa+"')\">+ "+o.nazwa+"</button>"}):i+='<div class="srl-opcje-info">—</div>'}else i+='<div class="srl-opcje-info">Za p\xf3źno na zmiany</div>'}else if("wolny"===a.status){var l=[];a.ma_filmowanie&&"0"!=a.ma_filmowanie||l.push({nazwa:"Filmowanie",id:srlFrontend.productIds.filmowanie}),a.ma_akrobacje&&"0"!=a.ma_akrobacje||l.push({nazwa:"Akrobacje",id:srlFrontend.productIds.akrobacje}),a.data_waznosci&&3390>=Math.floor((new Date(a.data_waznosci).getTime()-Date.now())/864e5)&&l.push({nazwa:"Przedłużenie",id:srlFrontend.productIds.przedluzenie}),l.length>0?l.forEach(function(o,r){i+='<button id="srl-opcja-'+a.id+"-"+o.id+'" class="srl-add-option srl-opcja-btn" data-lot-id="'+a.id+'" data-product-id="'+o.id+'" onclick="srlDodajOpcjeLotu('+a.id+", "+o.id+", '"+o.nazwa+"')\">+ "+o.nazwa+"</button>"}):i+='<div class="srl-opcje-info">—</div>'}else i+='<div class="srl-opcje-info">—</div>';if(i+="</td>",i+='<td class="srl-kolumna-akcje">',"zarezerwowany"===a.status){var e=new Date(a.data+" "+a.godzina_start),s=e.getTime()-Date.now();s>1728e5?i+='<button class="srl-anuluj-rezerwacje srl-akcja-btn srl-btn-odwolaj" data-lot-id="'+a.id+'">Odwołaj</button>':i+='<div class="srl-akcje-info">Za p\xf3źno</div>'}else"wolny"===a.status&&(i+='<button class="srl-wybierz-lot srl-akcja-btn srl-btn-wybierz" data-lot-id="'+a.id+'">Wybierz termin</button>');i+="</td>",i+="</tr>"}),i+="</tbody></table>",n.html(i),a(".srl-anuluj-rezerwacje").on("click",function(){var r;r=a(this).data("lot-id"),confirm("Czy na pewno chcesz anulować tę rezerwację?")&&a.ajax({url:srlFrontend.ajaxurl,method:"POST",data:{action:"srl_anuluj_rezerwacje_klient",nonce:srlFrontend.nonce,lot_id:r},success:function(a){a.success?(g("Rezerwacja została anulowana.","success"),o()):g("Błąd: "+a.data,"error")},error:function(){g("Błąd połączenia z serwerem.","error")}})}),console.log("✅ [DEBUG] Lista lot\xf3w wypełniona z "+e.length+" elementami")}(e),n=l.dane_osobowe,a("#srl-imie").val(n.imie||""),a("#srl-nazwisko").val(n.nazwisko||""),a("#srl-rok-urodzenia").val(n.rok_urodzenia||""),a("#srl-kategoria-wagowa").val(n.kategoria_wagowa||""),a("#srl-sprawnosc-fizyczna").val(n.sprawnosc_fizyczna||""),a("#srl-telefon").val(n.telefon||""),a("#srl-uwagi").val(n.uwagi||""),"function"==typeof v&&v(),a(document).trigger("srl_dane_klienta_zaladowane")):(console.error("❌ [ERROR] Błąd ładowania danych:",r.data),g("Błąd ładowania danych: "+r.data,"error"))},error:function(a,o,r){m(),console.error("❌ [ERROR] Błąd AJAX ładowania danych:",{xhr:a,status:o,error:r}),g("Błąd połączenia z serwerem.","error")}})}(),function o(){function e(){return!!s||!!window.wybranyLot||(g("Musisz najpierw wybrać lot do zarezerwowania.","error"),!1)}a(".srl-step").on("click",function(){var o=parseInt(a(this).data("step"));o<=r&&c(o)}),a("#srl-formularz-pasazera").on("submit",function(a){a.preventDefault(),u()}),a("#srl-poprzedni-miesiac").on("click",function(){z(-1)}),a("#srl-nastepny-miesiac").on("click",function(){z(1)}),a("#srl-powrot-krok-1").on("click",function(){c(1)}),a("#srl-powrot-krok-2").on("click",function(){c(2)}),a("#srl-powrot-krok-3").on("click",function(){c(3)}),a("#srl-powrot-krok-4").on("click",function(){c(4)}),a("#srl-dalej-krok-5").on("click",function(){c(5)}),a(document).on("click",".srl-wybierz-lot",function(){var o=a(this).data("lot-id");s=o,window.wybranyLot=o,c(2),function o(){var r=s||window.wybranyLot,e=l||window.daneKlienta;if(r&&e&&e.dostepne_loty){var n=e.dostepne_loty.find(function(a){return a.id==r});if(n){var i=n.nazwa_produktu.split(" - ")[0];(i.toLowerCase().includes("voucher")||i.toLowerCase().includes("lot")||i.toLowerCase().includes("tandem"))&&(i="Lot w tandemie");var t=n.ma_filmowanie&&"0"!=n.ma_filmowanie,d=n.ma_akrobacje&&"0"!=n.ma_akrobacje,c=[];t?c.push('<span style="color: #46b450;">z filmowaniem</span>'):c.push('<span style="color: #d63638;">brak filmowania</span>'),d?c.push('<span style="color: #46b450;">z akrobacjami</span>'):c.push('<span style="color: #d63638;">brak akrobacji</span>');var p="<strong>Lot #"+n.id+" – "+j(i);p+=' <span style="font-weight: bold;">'+c.join(", ")+"</span>",p+="</strong>",n.kod_vouchera,t&&d||(p+='<div style="background: #f0f8ff; border: 2px solid #46b450; border-radius: 8px; padding: 20px; margin-top: 15px;">',t||d?t?d||(p+='<h4 style="margin-top: 0; color: #46b450;">Nie wybrałeś akrobacji?</h4>',p+="<p>To oczywiście nie jest obowiązkowe – ale jeśli lubisz odrobinę adrenaliny, to może być coś dla Ciebie!</p>",p+="<p><strong>Akrobacje w locie</strong> to kilka dynamicznych manewr\xf3w, kt\xf3re robią wrażenie i zostają w pamięci na długo.</p>",p+="<p>Możesz wykupić je teraz online lub na lotnisku – bezpośrednio na lotnisku, za got\xf3wkę.</p>",p+='<div style="text-align: center; margin-top: 15px;">',p+='<button id="srl-opcja-'+n.id+"-"+srlFrontend.productIds.akrobacje+'" class="srl-add-option srl-btn srl-btn-success" style="padding: 10px 20px;" data-lot-id="'+n.id+'" data-product-id="'+srlFrontend.productIds.akrobacje+'" onclick="srlDodajOpcjeLotu('+n.id+", "+srlFrontend.productIds.akrobacje+", 'Akrobacje podczas lotu')\">\uD83D\uDC49 Dodaj akrobacje do koszyka</button>",p+="</div>"):(p+='<h4 style="margin-top: 0; color: #46b450;">Nie masz dodanego filmowania do swojego lotu?</h4>',p+="<p>To nic, ale warto wiedzieć, że to bardzo lubiana opcja wśr\xf3d pasażer\xf3w.</p>",p+="<p>\uD83C\uDFA5 <strong>Film z lotu</strong> pozwala wracać do tych emocji, dzielić się nimi z bliskimi i zachować wyjątkową pamiątkę.</p>",p+="<p>Możesz wykupić je teraz online lub na lotnisku – bezpośrednio na lotnisku, za got\xf3wkę.</p>",p+='<div style="text-align: center; margin-top: 15px;">',p+='<button id="srl-opcja-'+n.id+"-"+srlFrontend.productIds.filmowanie+'" class="srl-add-option srl-btn srl-btn-success" style="padding: 10px 20px;" data-lot-id="'+n.id+'" data-product-id="'+srlFrontend.productIds.filmowanie+'" onclick="srlDodajOpcjeLotu('+n.id+", "+srlFrontend.productIds.filmowanie+", 'Filmowanie lotu')\">\uD83D\uDC49 Dodaj filmowanie do koszyka</button>",p+="</div>"):(p+='<h4 style="margin-top: 0; color: #46b450;">\uD83C\uDF1F Czy wiesz, że Tw\xf3j lot może być jeszcze ciekawszy?</h4>',p+="<p>Nie masz dodanego <strong>filmowania</strong> ani <strong>akrobacji</strong> – to dwie opcje, kt\xf3re często wybierają nasi pasażerowie.</p>",p+="<p><strong>Film z lotu</strong> to świetna pamiątka, kt\xf3rą możesz pokazać znajomym.</br><strong>Akrobacje</strong>? Idealne, jeśli masz ochotę na więcej adrenaliny!</p>",p+="<p>Możesz wykupić je teraz online lub na lotnisku – bezpośrednio na lotnisku, za got\xf3wkę.</p>",p+='<div style="text-align: center; margin-top: 15px;">',p+='<button id="srl-opcja-'+n.id+"-"+srlFrontend.productIds.filmowanie+'" class="srl-add-option srl-btn srl-btn-success" style="margin: 5px; padding: 10px 20px;" data-lot-id="'+n.id+'" data-product-id="'+srlFrontend.productIds.filmowanie+'" onclick="srlDodajOpcjeLotu('+n.id+", "+srlFrontend.productIds.filmowanie+", 'Filmowanie lotu')\">\uD83D\uDC49 Dodaj filmowanie</button>",p+='<button id="srl-opcja-'+n.id+"-"+srlFrontend.productIds.akrobacje+'" class="srl-add-option srl-btn srl-btn-success" style="margin: 5px; padding: 10px 20px;" data-lot-id="'+n.id+'" data-product-id="'+srlFrontend.productIds.akrobacje+'" onclick="srlDodajOpcjeLotu('+n.id+", "+srlFrontend.productIds.akrobacje+", 'Akrobacje podczas lotu')\">\uD83D\uDC49 Dodaj akrobacje</button>",p+="</div>"),p+="</div>"),a("#srl-wybrany-lot-szczegoly").html(p)}}}()}),a("#srl-potwierdz-rezerwacje").on("click",function(){(function o(){if(!t||!s){g("Brak wybranych danych do rezerwacji.","error");return}var r=a("#srl-potwierdz-rezerwacje");r.prop("disabled",!0).text("Finalizowanie rezerwacji..."),a.ajax({url:srlFrontend.ajaxurl,method:"POST",data:{action:"srl_dokonaj_rezerwacji",nonce:srlFrontend.nonce,termin_id:t,lot_id:s},success:function(o){var e;o.success?(e='<div class="srl-komunikat srl-komunikat-success" style="text-align:center; padding:40px;">',e+='<h2 style="color:#46b450; margin-bottom:20px;text-transform: uppercase;">Rezerwacja potwierdzona!</h2>',e+='<p style="font-size:18px; margin-bottom:30px;">Tw\xf3j lot tandemowy został zarezerwowany na <strong>'+y(i)+"</strong></p>",e+="<p>Na podany adres email została wysłana informacja z szczeg\xf3łami rezerwacji.</p>",e+='<div style="margin-top:30px;">',e+='<a href="'+window.location.href+'" class="srl-btn srl-btn-primary">Zarezerwuj kolejny lot</a>',e+="</div>",e+="</div>",a("#srl-rezerwacja-container").html(e)):(g("Błąd rezerwacji: "+o.data,"error"),r.prop("disabled",!1).text("\uD83C\uDFAF Potwierdź rezerwację"))},error:function(){g("Błąd połączenia z serwerem.","error"),r.prop("disabled",!1).text("\uD83C\uDFAF Potwierdź rezerwację")}})})()}),a('.srl-step[data-step="2"]').on("click",function(a){if(!s&&!window.wybranyLot)return a.preventDefault(),a.stopPropagation(),g("Musisz najpierw wybrać lot do zarezerwowania.","error"),!1})}();var p=c;c=function(o){p(o),5===o&&function o(){var r=l.dostepne_loty.find(function(a){return a.id==s}),e=d?d.slot:null;if(r){var n=r.nazwa_produktu.split(" - ")[0];(n.toLowerCase().includes("voucher")||n.toLowerCase().includes("lot")||n.toLowerCase().includes("tandem"))&&(n="Lot w tandemie");var t=[];r.ma_filmowanie&&"0"!=r.ma_filmowanie?t.push('<span style="color: #46b450;">z filmowaniem</span>'):t.push('<span style="color: #d63638;">brak filmowania</span>'),r.ma_akrobacje&&"0"!=r.ma_akrobacje?t.push('<span style="color: #46b450;">z akrobacjami</span>'):t.push('<span style="color: #d63638;">brak akrobacji</span>');var c="#"+r.id+" – "+j(n);c+=' <span style="font-weight: bold;">'+t.join(", ")+"</span>",r.kod_vouchera,a("#srl-lot-details").html(c)}if(e){var p=y(i)+", godz. "+e.godzina_start.substring(0,5)+" - "+e.godzina_koniec.substring(0,5);a("#srl-datetime-details").html(p)}var u="";u+="<p><strong>Imię i nazwisko:</strong> "+a("#srl-imie").val()+" "+a("#srl-nazwisko").val()+"</p>",u+="<p><strong>Rok urodzenia:</strong> "+a("#srl-rok-urodzenia").val()+"</p>",u+="<p><strong>Wiek:</strong> "+(new Date().getFullYear()-a("#srl-rok-urodzenia").val())+" lat</p>",u+="<p><strong>Telefon:</strong> "+a("#srl-telefon").val()+"</p>",u+="<p><strong>Sprawność fizyczna:</strong> "+a("#srl-sprawnosc-fizyczna option:selected").text()+"</p>",u+="<p><strong>Kategoria wagowa:</strong> "+a("#srl-kategoria-wagowa").val()+"</p>";var w=a("#srl-kategoria-wagowa").val();"91-120kg"===w?(u+='<div class="srl-uwaga" style="background:#fff3e0; border:2px solid #ff9800; border-radius:8px; padding:15px; margin:15px 0;">',u+='<p style="margin:0;">Loty z pasażerami powyżej 90 kg mogą być kr\xf3tsze, brak możliwości wykonania akrobacji. Pilot ma prawo odm\xf3wić wykonania lotu jeśli uzna, że zagraża to bezpieczeństwu.</p>',u+="</div>"):"120kg+"===w&&(u+='<div class="srl-uwaga" style="background:#fdeaea; border:2px solid #d63638; border-radius:8px; padding:15px; margin:15px 0;">',u+='<h4 style="margin-top:0; color:#721c24;">❌ Błąd wagowy:</h4>',u+='<p style="margin:0;">Brak możliwości wykonania lotu z pasażerem powyżej 120 kg.</p>',u+="</div>");var z=a("#srl-uwagi").val();z&&(u+="<p><strong>Uwagi:</strong> "+j(z)+"</p>"),a("#srl-dane-pasazera-podsumowanie").html(u)}()};function u(){if(!s&&!window.wybranyLot){g("Błąd: Nie wybrano lotu do rezerwacji. Wr\xf3ć do kroku 1.","error");return}var o={action:"srl_zapisz_dane_pasazera",nonce:srlFrontend.nonce,imie:a("#srl-imie").val(),nazwisko:a("#srl-nazwisko").val(),rok_urodzenia:a("#srl-rok-urodzenia").val(),kategoria_wagowa:a("#srl-kategoria-wagowa").val(),sprawnosc_fizyczna:a("#srl-sprawnosc-fizyczna").val(),telefon:a("#srl-telefon").val(),uwagi:a("#srl-uwagi").val(),akceptacja_regulaminu:a("#srl-akceptacja-regulaminu").is(":checked")},r=a('#srl-formularz-pasazera button[type="submit"]');r.prop("disabled",!0).text("Zapisywanie..."),a.ajax({url:srlFrontend.ajaxurl,method:"POST",data:o,success:function(a){a.success?(l.dane_osobowe={imie:o.imie,nazwisko:o.nazwisko,rok_urodzenia:o.rok_urodzenia,kategoria_wagowa:o.kategoria_wagowa,sprawnosc_fizyczna:o.sprawnosc_fizyczna,telefon:o.telefon,uwagi:o.uwagi,akceptacja_regulaminu:o.akceptacja_regulaminu},c(3),w(),k()):g("Błąd: "+a.data,"error")},error:function(){g("Błąd połączenia z serwerem.","error")},complete:function(){r.prop("disabled",!1).text("Zapisz i przejdź dalej →")}})}function w(){a("#srl-miesiac-rok").text(["Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","Październik","Listopad","Grudzień"][e-1]+" "+n)}function z(a){(e+=a)>12?(e=1,n++):e<1&&(e=12,n--),w(),k()}function k(){a("#srl-kalendarz-tabela").html('<div class="srl-loader">Ładowanie dostępnych termin\xf3w...</div>'),a.ajax({url:srlFrontend.ajaxurl,method:"GET",data:{action:"srl_pobierz_dostepne_dni",nonce:srlFrontend.nonce,rok:n,miesiac:e},success:function(o){o.success?function o(r){var s=new Date(n,e-1,1),l=new Date(n,e,0).getDate(),p=s.getDay(),u='<table class="srl-kalendarz-tabela">';u+="<thead><tr><th>Pon</th><th>Wt</th><th>Śr</th><th>Czw</th><th>Pt</th><th>Sob</th><th>Nd</th></tr></thead>",u+="<tbody>";for(var w=1,z=(p=0===p?7:p)-1,k=7*Math.ceil((l+z)/7),m=0;m<k;m++){if(m%7==0&&(u+="<tr>"),m<z||w>l)u+='<td class="srl-dzien-pusty"></td>';else{var b,j=n+"-"+f(e)+"-"+f(w),v=r[j]||0;u+='<td class="'+(v>0?"srl-dzien-dostepny":"srl-dzien-niedostepny")+'"'+(v>0?' data-data="'+j+'"':"")+">",u+='<div class="srl-dzien-numer">'+w+"</div>",v>0&&(u+='<div class="srl-dzien-sloty">'+v+" wolnych</div>"),u+="</td>",w++}(m+1)%7==0&&(u+="</tr>")}u+="</tbody></table>",a("#srl-kalendarz-tabela").html(u),a(".srl-dzien-dostepny").on("click",function(){i=a(this).data("data"),a(".srl-dzien-wybrany").removeClass("srl-dzien-wybrany"),a(this).addClass("srl-dzien-wybrany"),c(4),a("#srl-wybrany-dzien-info").html("<p><strong>Wybrany dzień:</strong> "+y(i)+"</p>"),a("#srl-harmonogram-frontend").html('<div class="srl-loader">Ładowanie dostępnych godzin...</div>'),a.ajax({url:srlFrontend.ajaxurl,method:"GET",data:{action:"srl_pobierz_dostepne_godziny",nonce:srlFrontend.nonce,data:i},success:function(o){o.success?function o(r){if(!r||0===r.length){a("#srl-harmonogram-frontend").html('<p class="srl-komunikat srl-komunikat-info">Brak dostępnych godzin w tym dniu.</p>');return}r.sort(function(a,o){return a.godzina_start.localeCompare(o.godzina_start)});var e='<div class="srl-godziny-grid">';r.forEach(function(a){e+='<div class="srl-slot-godzina" data-slot-id="'+a.id+'">',e+='<div class="srl-slot-czas">'+a.godzina_start.substring(0,5)+" - "+a.godzina_koniec.substring(0,5)+"</div>",e+="</div>"}),e+="</div>",a("#srl-harmonogram-frontend").html(e),a(".srl-slot-godzina").on("click",function(){var o,r,e;o=a(this).data("slot-id"),r=a(this),a(".srl-slot-wybrany").removeClass("srl-slot-wybrany"),r.addClass("srl-slot-wybrany"),t=o,a("#srl-dalej-krok-5").show(),e=o,a.ajax({url:srlFrontend.ajaxurl,method:"POST",data:{action:"srl_zablokuj_slot_tymczasowo",nonce:srlFrontend.nonce,termin_id:e},success:function(o){o.success?(d=o.data,g("Termin został zarezerwowany na 15 minut.","info"),setTimeout(function(){g("Blokada terminu wygasła. Wybierz termin ponownie.","warning"),a(".srl-slot-wybrany").removeClass("srl-slot-wybrany"),a("#srl-dalej-krok-5").hide(),t=null,d=null},9e5)):(g("Błąd blokady: "+o.data,"error"),a(".srl-slot-wybrany").removeClass("srl-slot-wybrany"),t=null,a("#srl-dalej-krok-5").hide())},error:function(){g("Błąd połączenia z serwerem.","error")}})})}(o.data):a("#srl-harmonogram-frontend").html('<p class="srl-komunikat srl-komunikat-error">Błąd: '+o.data+"</p>")},error:function(){a("#srl-harmonogram-frontend").html('<p class="srl-komunikat srl-komunikat-error">Błąd połączenia z serwerem.</p>')}})})}(o.data):a("#srl-kalendarz-tabela").html('<p class="srl-komunikat srl-komunikat-error">Błąd: '+o.data+"</p>")},error:function(){a("#srl-kalendarz-tabela").html('<p class="srl-komunikat srl-komunikat-error">Błąd połączenia z serwerem.</p>')}})}function g(o,r){var e=a("#srl-komunikaty");0===e.length&&(a("#srl-formularz-pasazera").prepend('<div id="srl-komunikaty"></div>'),e=a("#srl-komunikaty")),e.append('<div class="srl-komunikat srl-komunikat-'+r+'">'+o+"</div>").show(),setTimeout(function(){e.fadeOut(function(){e.empty()})},15e3)}function m(){a("#srl-komunikaty").empty()}function y(a){var o=new Date(a),r=o.getDate(),e=o.getMonth()+1,n=o.getFullYear();return["Niedziela","Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota"][o.getDay()]+", "+r+" "+["stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","września","października","listopada","grudnia"][e-1]+" "+n}function b(a,o){var r,e=new Date(a),n=e.getDate(),i=e.getMonth()+1,t=e.getFullYear(),s=o.substring(0,5);return n+"&nbsp;"+["stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","września","października","listopada","grudnia"][i-1]+"&nbsp;"+t+"<br>godz.&nbsp;"+s+"<br>"+["Niedziela","Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota"][e.getDay()]}function f(a){return a<10?"0"+a:""+a}function j(a){var o=document.createElement("div");return o.innerText=a,o.innerHTML}function v(){var o=a("#srl-kategoria-wagowa").val(),r=parseInt(a("#srl-rok-urodzenia").val()),e=new Date().getFullYear(),n=a("#srl-waga-ostrzezenie");n.hide();var i=[];r&&e-r<=18&&i.push('<div class="srl-uwaga" style="background:#fff3e0; border:2px solid #ff9800; border-radius:8px; padding:20px; margin-top:10px;"><strong>Lot osoby niepełnoletniej:</strong> Osoby poniżej 18. roku życia mogą wziąć udział w locie tylko za zgodą rodzica lub opiekuna prawnego. Wymagane jest okazanie podpisanej, wydrukowanej zgody w dniu lotu, na miejscu startu. <a href="/zgoda-na-lot-osoba-nieletnia/" target="_blank" style="color:#f57c00; font-weight:bold;">Pobierz zgodę tutaj</a>.</div>'),"91-120kg"===o?i.push('<div class="srl-uwaga" style="background:#fff3e0; border:2px solid #ff9800; border-radius:8px; padding:20px; margin-top:10px;"><strong>Uwaga:</strong> Loty z pasażerami powyżej 90 kg mogą być kr\xf3tsze, brak możliwości wykonania akrobacji. Pilot ma prawo odm\xf3wić wykonania lotu jeśli uzna, że zagraża to bezpieczeństwu.</div>'):"120kg+"===o&&i.push('<div class="srl-uwaga" style="background:#fdeaea; border:2px solid #d63638; border-radius:8px; padding:20px; margin-top:10px; color:#721c24;"><strong>❌ Błąd:</strong> Brak możliwości wykonania lotu z pasażerem powyżej 120 kg.</div>'),i.length>0&&(n.html(i.join("")),n.show())}function h(){var o=s||window.wybranyLot,r=a("#srl-kategoria-wagowa").val();if(!o||!r)return!0;var e=l.dostepne_loty.find(function(a){return a.id==o});if(!e)return!0;var n=!1;return(["67","69","76","77"].forEach(function(a){(-1!==e.nazwa_produktu.indexOf(a)||-1!==e.nazwa_produktu.toLowerCase().indexOf("akrobacj"))&&(n=!0)}),n&&("91-120kg"===r||"120kg+"===r))?(g("Wybrana kategoria wagowa ("+r+") nie jest dostępna dla lot\xf3w z akrobacjami.","error"),!1):"120kg+"!==r||(g("Loty nie są możliwe dla pasażer\xf3w powyżej 120 kg.","error"),!1)}a(document).on("change","#srl-rok-urodzenia",function(){v()}),a(document).on("change","#srl-kategoria-wagowa",function(){v(),h()});var $=u;u=function(){a("#srl-komunikaty").empty().hide();var o=[];a("#srl-akceptacja-regulaminu").is(":checked")||o.push("Musisz zaakceptować Regulamin."),"120kg+"===a("#srl-kategoria-wagowa").val()&&o.push("Nie można dokonać rezerwacji z kategorią wagową 120kg+");var r=a("#srl-telefon").val().trim();if(r&&r.replace(/[\s\-\(\)\+48]/g,"").length<9&&o.push("Numer telefonu musi mieć minimum 9 cyfr."),h()||o.push("Wybrana kategoria wagowa nie jest dostępna dla lot\xf3w z akrobacjami."),o.length>0){o.forEach(function(a){g(a,"error")});return}$()}}),jQuery(document).ready(function(a){a(document).on("change","#srl-rok-urodzenia",function(){sprawdzKategorieWagowaWiekowa()}),a(document).on("change","#srl-kategoria-wagowa",function(){sprawdzKategorieWagowaWiekowa(),sprawdzKompatybilnoscZAkrobacjami()}),void 0===window.zapiszDanePasazeraOriginal&&(window.zapiszDanePasazeraOriginal=window.zapiszDanePasazera,window.zapiszDanePasazera=function(){if(console.log("✅ [DEBUG] Walidacja danych pasażera..."),!a("#srl-akceptacja-regulaminu").is(":checked")){"function"==typeof pokazKomunikat&&pokazKomunikat("Musisz zaakceptować Regulamin.","error");return}if("120kg+"===a("#srl-kategoria-wagowa").val()){"function"==typeof pokazKomunikat&&pokazKomunikat("Nie można dokonać rezerwacji z kategorią wagową 120kg+","error");return}sprawdzKompatybilnoscZAkrobacjami()&&(console.log("✅ [DEBUG] Walidacja przeszła pomyślnie"),"function"==typeof window.zapiszDanePasazeraOriginal&&window.zapiszDanePasazeraOriginal())})}),console.log("\uD83C\uDFAF [DEBUG] System walidacji i opcji lot\xf3w zainicjalizowany");