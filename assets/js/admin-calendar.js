jQuery(document).ready(function(r){var a=1,o=1,e=new Date().getMonth()+1,t=new Date().getFullYear(),n=null,s=null,l=null,i=null,d=null;function c(e){if(!(e<1)&&!(e>4)){r(".srl-step").removeClass("srl-step-active srl-step-completed");for(var t=1;t<=4;t++){var n=r('.srl-step[data-step="'+t+'"]');t<e?n.addClass("srl-step-completed"):t===e&&n.addClass("srl-step-active")}r(".srl-krok").removeClass("srl-krok-active"),r("#srl-krok-"+e).addClass("srl-krok-active"),a=e,o=Math.max(o,e),r("html, body").animate({scrollTop:r("#srl-rezerwacja-container").offset().top-50},300)}}(function a(){w("Ładowanie danych...","info"),r.ajax({url:srlFrontend.ajaxurl,method:"GET",data:{action:"srl_pobierz_dane_klienta",nonce:srlFrontend.nonce},success:function(o){var e;m(),o.success?(function o(e){var t=r("#srl-lista-rezerwacji");if(!e||0===e.length){t.html('<p class="srl-komunikat srl-komunikat-info">Nie masz aktualnych rezerwacji.</p>');return}var n='<table class="srl-tabela">';n+="<thead><tr><th>Zam\xf3wienie</th><th>Produkt</th><th>Data</th><th>Godzina</th><th>Akcje</th></tr></thead>",n+="<tbody>",e.forEach(function(r){var a=new Date(r.data+" "+r.godzina_start).getTime()-Date.now();n+="<tr>",n+="<td>#"+r.order_id+"</td>",n+="<td>"+v(r.nazwa_produktu)+"</td>",n+="<td>"+h(r.data)+"</td>",n+="<td>"+r.godzina_start.substring(0,5)+"</td>",n+="<td>",a>1728e5?n+='<button class="srl-btn srl-btn-secondary srl-anuluj-rezerwacje" data-lot-id="'+r.id+'">Odwołaj</button>':n+='<span style="color:#999; font-style:italic;">Nie możesz już dokonać zmian</span>',n+="</td></tr>"}),n+="</tbody></table>",t.html(n),r(".srl-anuluj-rezerwacje").on("click",function(){var o;o=r(this).data("lot-id"),confirm("Czy na pewno chcesz anulować tę rezerwację?")&&r.ajax({url:srlFrontend.ajaxurl,method:"POST",data:{action:"srl_anuluj_rezerwacje_klient",nonce:srlFrontend.nonce,lot_id:o},success:function(r){r.success?(w("Rezerwacja została anulowana.","success"),a()):w("Błąd: "+r.data,"error")},error:function(){w("Błąd połączenia z serwerem.","error")}})})}((i=o.data).rezerwacje),function a(o){var e=r("#srl-wybor-lotu");if(!o||0===o.length){e.html('<p class="srl-komunikat srl-komunikat-warning">Nie masz dostępnych lot\xf3w do zarezerwowania.</p>');return}var t='<div class="srl-form-group">';if(t+='<label for="srl-wybrany-lot">Wybierz lot do zarezerwowania:</label>',1===o.length){var n=o[0];t+='<div style="padding:15px; background:#f8f9fa; border-radius:8px; font-weight:600;">',t+="#"+n.order_id+" – "+v(n.nazwa_produktu),t+='<input type="hidden" id="srl-wybrany-lot" value="'+n.id+'">',t+="</div>"}else t+='<select id="srl-wybrany-lot" required>',t+='<option value="">Wybierz lot...</option>',o.forEach(function(r){t+='<option value="'+r.id+'">#'+r.order_id+" – "+v(r.nazwa_produktu)+"</option>"}),t+="</select>";t+="</div>",t+='<p style="margin-top:15px; color:#0073aa; font-weight:500;">\uD83C\uDFAB Ilość lot\xf3w do zarezerwowania: '+o.length+"</p>",e.html(t)}(i.dostepne_loty),e=i.dane_osobowe,r("#srl-imie").val(e.imie||""),r("#srl-nazwisko").val(e.nazwisko||""),r("#srl-rok-urodzenia").val(e.rok_urodzenia||""),r("#srl-plec").val(e.plec||""),r("#srl-waga").val(e.waga||""),r("#srl-wzrost").val(e.wzrost||""),r("#srl-telefon").val(e.telefon||""),r("#srl-uwagi").val(e.uwagi||""),i.dane_kompletne&&r('#srl-formularz-pasazera button[type="submit"]').text("Przejdź dalej →")):w("Błąd ładowania danych: "+o.data,"error")},error:function(){m(),w("Błąd połączenia z serwerem.","error")}})})(),r(".srl-step").on("click",function(){var a=parseInt(r(this).data("step"));a<=o&&c(a)}),r("#srl-formularz-pasazera").on("submit",function(a){a.preventDefault(),function a(){var o={action:"srl_zapisz_dane_pasazera",nonce:srlFrontend.nonce,imie:r("#srl-imie").val(),nazwisko:r("#srl-nazwisko").val(),rok_urodzenia:r("#srl-rok-urodzenia").val(),plec:r("#srl-plec").val(),waga:r("#srl-waga").val(),wzrost:r("#srl-wzrost").val(),telefon:r("#srl-telefon").val(),uwagi:r("#srl-uwagi").val()};if(!(l=r("#srl-wybrany-lot").val())){w("Wybierz lot do zarezerwowania.","error");return}var e=r('#srl-formularz-pasazera button[type="submit"]');e.prop("disabled",!0).text("Zapisywanie..."),r.ajax({url:srlFrontend.ajaxurl,method:"POST",data:o,success:function(r){r.success?(c(2),u(),z()):w("Błąd: "+r.data,"error")},error:function(){w("Błąd połączenia z serwerem.","error")},complete:function(){e.prop("disabled",!1).text("Zapisz i przejdź dalej →")}})}()}),r("#srl-poprzedni-miesiac").on("click",function(){p(-1)}),r("#srl-nastepny-miesiac").on("click",function(){p(1)}),r("#srl-powrot-krok-1").on("click",function(){c(1)}),r("#srl-powrot-krok-2").on("click",function(){c(2)}),r("#srl-powrot-krok-3").on("click",function(){c(3)}),r("#srl-dalej-krok-4").on("click",function(){c(4)}),r("#srl-potwierdz-rezerwacje").on("click",function(){(function a(){if(!s||!l){w("Brak wybranych danych do rezerwacji.","error");return}var o=r("#srl-potwierdz-rezerwacje");o.prop("disabled",!0).text("Finalizowanie rezerwacji..."),r.ajax({url:srlFrontend.ajaxurl,method:"POST",data:{action:"srl_dokonaj_rezerwacji",nonce:srlFrontend.nonce,termin_id:s,lot_id:l},success:function(a){var e;a.success?(e='<div class="srl-komunikat srl-komunikat-success" style="text-align:center; padding:40px;">',e+='<h2 style="color:#46b450; margin-bottom:20px;">\uD83C\uDF89 Rezerwacja potwierdzona!</h2>',e+='<p style="font-size:18px; margin-bottom:30px;">Tw\xf3j lot tandemowy został zarezerwowany na <strong>'+h(n)+"</strong></p>",e+="<p>Na podany adres email została wysłana informacja z szczeg\xf3łami rezerwacji.</p>",e+='<div style="margin-top:30px;">',e+='<a href="'+window.location.href+'" class="srl-btn srl-btn-primary">Zarezerwuj kolejny lot</a>',e+="</div>",e+="</div>",r("#srl-rezerwacja-container").html(e)):(w("Błąd rezerwacji: "+a.data,"error"),o.prop("disabled",!1).text("\uD83C\uDFAF Potwierdź rezerwację"))},error:function(){w("Błąd połączenia z serwerem.","error"),o.prop("disabled",!1).text("\uD83C\uDFAF Potwierdź rezerwację")}})})()});function u(){r("#srl-miesiac-rok").text(["Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","Październik","Listopad","Grudzień"][e-1]+" "+t)}function p(r){(e+=r)>12?(e=1,t++):e<1&&(e=12,t--),u(),z()}function z(){r("#srl-kalendarz-tabela").html('<div class="srl-loader">Ładowanie dostępnych termin\xf3w...</div>'),r.ajax({url:srlFrontend.ajaxurl,method:"GET",data:{action:"srl_pobierz_dostepne_dni",nonce:srlFrontend.nonce,rok:t,miesiac:e},success:function(a){a.success?function a(o){var l=new Date(t,e-1,1),i=new Date(t,e,0).getDate(),u=l.getDay(),p='<table class="srl-kalendarz-tabela">';p+="<thead><tr><th>Pon</th><th>Wt</th><th>Śr</th><th>Czw</th><th>Pt</th><th>Sob</th><th>Nd</th></tr></thead>",p+="<tbody>";for(var z=1,m=(u=0===u?7:u)-1,v=7*Math.ceil((i+m)/7),f=0;f<v;f++){if(f%7==0&&(p+="<tr>"),f<m||z>i)p+='<td class="srl-dzien-pusty"></td>';else{var g,y=t+"-"+k(e)+"-"+k(z),b=o[y]||0;p+='<td class="'+(b>0?"srl-dzien-dostepny":"srl-dzien-niedostepny")+'"'+(b>0?' data-data="'+y+'"':"")+">",p+='<div class="srl-dzien-numer">'+z+"</div>",b>0&&(p+='<div class="srl-dzien-sloty">'+b+" wolnych</div>"),p+="</td>",z++}(f+1)%7==0&&(p+="</tr>")}p+="</tbody></table>",r("#srl-kalendarz-tabela").html(p),r(".srl-dzien-dostepny").on("click",function(){n=r(this).data("data"),r(".srl-dzien-wybrany").removeClass("srl-dzien-wybrany"),r(this).addClass("srl-dzien-wybrany"),c(3),r("#srl-wybrany-dzien-info").html("<p><strong>Wybrany dzień:</strong> "+h(n)+"</p>"),r("#srl-harmonogram-frontend").html('<div class="srl-loader">Ładowanie dostępnych godzin...</div>'),r.ajax({url:srlFrontend.ajaxurl,method:"GET",data:{action:"srl_pobierz_dostepne_godziny",nonce:srlFrontend.nonce,data:n},success:function(a){a.success?function a(o){if(!o||0===o.length){r("#srl-harmonogram-frontend").html('<p class="srl-komunikat srl-komunikat-info">Brak dostępnych godzin w tym dniu.</p>');return}var e='<div class="srl-godziny-grid">';o.forEach(function(r){e+='<div class="srl-slot-godzina" data-slot-id="'+r.id+'">',e+='<div class="srl-slot-czas">'+r.godzina_start.substring(0,5)+" - "+r.godzina_koniec.substring(0,5)+"</div>",e+='<div class="srl-slot-pilot">Pilot '+r.pilot_id+"</div>",e+="</div>"}),e+="</div>",r("#srl-harmonogram-frontend").html(e),r(".srl-slot-godzina").on("click",function(){var a,o,e;a=r(this).data("slot-id"),o=r(this),r(".srl-slot-wybrany").removeClass("srl-slot-wybrany"),o.addClass("srl-slot-wybrany"),s=a,r("#srl-dalej-krok-4").show(),e=a,r.ajax({url:srlFrontend.ajaxurl,method:"POST",data:{action:"srl_zablokuj_slot_tymczasowo",nonce:srlFrontend.nonce,termin_id:e},success:function(a){a.success?(d=a.data,w("Termin został zarezerwowany na 15 minut.","info"),setTimeout(function(){w("Blokada terminu wygasła. Wybierz termin ponownie.","warning"),r(".srl-slot-wybrany").removeClass("srl-slot-wybrany"),r("#srl-dalej-krok-4").hide(),s=null,d=null},9e5)):(w("Błąd blokady: "+a.data,"error"),r(".srl-slot-wybrany").removeClass("srl-slot-wybrany"),s=null,r("#srl-dalej-krok-4").hide())},error:function(){w("Błąd połączenia z serwerem.","error")}})})}(a.data):r("#srl-harmonogram-frontend").html('<p class="srl-komunikat srl-komunikat-error">Błąd: '+a.data+"</p>")},error:function(){r("#srl-harmonogram-frontend").html('<p class="srl-komunikat srl-komunikat-error">Błąd połączenia z serwerem.</p>')}})})}(a.data):r("#srl-kalendarz-tabela").html('<p class="srl-komunikat srl-komunikat-error">Błąd: '+a.data+"</p>")},error:function(){r("#srl-kalendarz-tabela").html('<p class="srl-komunikat srl-komunikat-error">Błąd połączenia z serwerem.</p>')}})}function w(a,o){r("#srl-komunikaty").html('<div class="srl-komunikat srl-komunikat-'+o+'">'+a+"</div>"),setTimeout(function(){r("#srl-komunikaty").fadeOut()},5e3)}function m(){r("#srl-komunikaty").empty()}function h(r){var a=new Date(r),o=a.getDate(),e=a.getMonth()+1,t=a.getFullYear();return["Niedziela","Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota"][a.getDay()]+", "+o+" "+["stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","września","października","listopada","grudnia"][e-1]+" "+t}function k(r){return r<10?"0"+r:""+r}function v(r){var a=document.createElement("div");return a.innerText=r,a.innerHTML}var f=c;c=function(a){if(f(a),4===a){var o,e,t,s;o='<div class="srl-podsumowanie-box" style="background:#f8f9fa; padding:30px; border-radius:8px; margin:20px 0;">',o+='<h3 style="margin-top:0; color:#0073aa;">\uD83D\uDCCB Podsumowanie rezerwacji</h3>',e=i.dostepne_loty.find(function(r){return r.id==l}),t=d?d.slot:null,o+='<div class="srl-podsumowanie-grid" style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin:20px 0;">',o+="<div><strong>\uD83C\uDFAB Wybrany lot:</strong><br>#"+e.order_id+" – "+v(e.nazwa_produktu)+"</div>",o+="<div><strong>\uD83D\uDCC5 Data lotu:</strong><br>"+h(n)+"</div>",t&&(o+="<div><strong>⏰ Godzina:</strong><br>"+t.godzina_start.substring(0,5)+" - "+t.godzina_koniec.substring(0,5)+"</div>",o+="<div><strong>\uD83D\uDC68‍✈️ Pilot:</strong><br>Pilot "+t.pilot_id+"</div>"),o+="</div>",o+='<div style="background:white; padding:20px; border-radius:8px; margin-top:20px;">',o+='<h4 style="margin-top:0; color:#333;">\uD83E\uDEAA Dane pasażera:</h4>',o+="<p><strong>Imię i nazwisko:</strong> "+r("#srl-imie").val()+" "+r("#srl-nazwisko").val()+"</p>",o+="<p><strong>Wiek:</strong> "+(new Date().getFullYear()-r("#srl-rok-urodzenia").val())+" lat</p>",o+="<p><strong>Waga:</strong> "+r("#srl-waga").val()+" kg</p>",o+="<p><strong>Wzrost:</strong> "+r("#srl-wzrost").val()+" cm</p>",o+="<p><strong>Telefon:</strong> "+r("#srl-telefon").val()+"</p>",(s=r("#srl-uwagi").val())&&(o+="<p><strong>Uwagi:</strong> "+v(s)+"</p>"),o+="</div>",o+='<div class="srl-uwaga" style="background:#fff3e0; border:2px solid #ff9800; border-radius:8px; padding:20px; margin-top:20px;">',o+='<h4 style="margin-top:0; color:#f57c00;">⚠️ Ważne informacje:</h4>',o+='<ul style="margin:0; padding-left:20px;">',o+="<li>Zgłoś się 30 minut przed godziną lotu</li>",o+="<li>Weź ze sobą dokument tożsamości</li>",o+="<li>Ubierz się stosownie do warunk\xf3w pogodowych</li>",o+="<li>Rezerwację można anulować do 48h przed lotem</li>",o+="</ul></div>",o+="</div>",r("#srl-podsumowanie-rezerwacji").html(o)}}}),$(document).ready(function(){$("#srl-voucher-show").on("click",function(){$("#srl-voucher-show").hide(),$("#srl-voucher-form").show(),$("#srl-voucher-code").focus()}),$("#srl-voucher-cancel").on("click",function(){$("#srl-voucher-form").hide(),$("#srl-voucher-show").show(),$("#srl-voucher-code").val("")}),$("#srl-voucher-code").on("input",function(){var r=$(this).val().toUpperCase().replace(/[^A-Z0-9]/g,"");$(this).val(r)}),$("#srl-voucher-submit").on("click",function(){var r=$("#srl-voucher-code").val().trim();if(r.length<1){pokazKomunikat("Wprowadź kod vouchera.","error");return}var a=$(this);a.prop("disabled",!0).text("Sprawdzanie..."),$.ajax({url:srlFrontend.ajaxurl,method:"POST",data:{action:"srl_wykorzystaj_voucher",kod_vouchera:r,nonce:srlFrontend.nonce},success:function(r){r.success?(pokazKomunikat(r.data.message,"success"),setTimeout(function(){zaladujDaneKlienta(),$("#srl-voucher-form").hide(),$("#srl-voucher-show").show(),$("#srl-voucher-code").val("")},2e3)):pokazKomunikat(r.data,"error")},error:function(){pokazKomunikat("Błąd połączenia z serwerem.","error")},complete:function(){a.prop("disabled",!1).text("Zatwierdź voucher")}})})});